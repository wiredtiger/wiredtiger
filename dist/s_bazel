#!/bin/bash

. `dirname -- ${BASH_SOURCE[0]}`/common_functions.sh
cd_top
setup_trap

cat << _E > $t

# DO NOT EDIT: automatically built by dist/s_bazel.

# This file is only used by external projects building WiredTiger via Bazel.

package(default_visibility = ["//visibility:public"])

_E

cat dist/filelist | grep -E '^[^#]' | {
    while read FILE PLATFORM; do
        eval "FILELIST_${PLATFORM}=\"\$FILELIST_${PLATFORM} \$FILE\""
    done
    set
} | grep -F FILELIST_ | sed -E '
    s/\x27//g;
    s/"//g;
    s/= /=[\n\t"/;
    s/$/"]\n/;
    s/ /",\n\t"/g
' >> $t

cmp $t dist/filelist.bzl > /dev/null || {
    echo "Updated dist/filelist.bzl"
    mv -f $t dist/filelist.bzl
}

